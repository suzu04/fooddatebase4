<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PFCç®¡ç†ãƒšãƒ¼ã‚¸</title>

    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: #f8fafc;
            color: #333;
            margin: 0;
        }

        header {
            background: #2f855a;
            color: #fff;
            padding: 26px 15px;
            position: relative;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        header h1 {
            margin: 0;
            font-size: 26px;
            text-align: center;
        }

        .menu-btn {
            position: absolute;
            right: 18px;
            top: 22px;
            font-size: 26px;
            cursor: pointer;
        }

        main {
            max-width: 1100px;
            margin: 30px auto;
            padding: 0 20px;
        }

        section {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        h2 {
            margin-top: 0;
            font-size: 20px;
        }

        .search-box {
            display: flex;
            gap: 10px;
        }

        .search-box input {
            flex: 1;
            padding: 8px;
            font-size: 16px;
        }

        .search-box button {
            padding: 8px 14px;
            background: #4caf50;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: center;
            font-size: 14px;
        }

        th {
            background: #e2f0d9;
        }

        .hamburger {
            position: fixed;
            top: 0;
            right: -320px;
            width: 300px;
            height: 100%;
            background: #fff;
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            transition: right 0.3s;
            z-index: 100;
        }

        .hamburger.open {
            right: 0;
        }

        footer {
            text-align: center;
            padding: 20px;
            font-size: 14px;
            color: #777;
        }
    </style>
</head>

<body>

    <header>
        <h1>PFCç®¡ç†ãƒšãƒ¼ã‚¸</h1>
        <div class="menu-btn" onclick="toggleMenu()">â˜°</div>
    </header>

    <main>

        <!-- ç›®æ¨™PFC -->
        <section>
            <h2>ğŸ“Š ç›®æ¨™PFC</h2>
            <div id="totalResult">
                <strong>0 kcal</strong><br>
                Pï¼š0 gã€€Fï¼š0 gã€€Cï¼š0 g<br>
                <a href="/pfc-compare">PFCè©³ç´°ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚‹ â†’</a>
            </div>
        </section>

        <!-- åˆè¨ˆPFC -->
        <section>
            <h2>ğŸ“Š åˆè¨ˆPFCï¼ˆé¸æŠã—ãŸé£Ÿå“ï¼‰</h2>
            <strong id="totalKcal">0 kcal</strong><br>
            Pï¼š<span id="totalP">0</span> gã€€
            Fï¼š<span id="totalF">0</span> gã€€
            Cï¼š<span id="totalC">0</span> g
        </section>

        <!-- æ¤œç´¢ -->
        <section>
            <h2>ğŸ” é£Ÿå“ã‚’æ¤œç´¢</h2>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="ä¾‹ï¼šã•ã•ã¿ã€ç±³">
                <button id="searchBtn">æ¤œç´¢</button>
            </div>
        </section>

        <!-- é¸æŠé£Ÿå“ -->
        <section>
            <h2>âœ… é¸æŠä¸­ã®é£Ÿå“</h2>

            <p>
                åˆ†é‡(g)
                <input type="number" id="gramInput" value="100" style="width:80px;">
                <button id="applyGram">è¨ˆç®—</button>
                <button id="resetGram">100gã«æˆ»ã™</button>
            </p>

            <table id="selectedTable">
                <thead>
                    <tr>
                        <th>ã‚°ãƒ«ãƒ¼ãƒ—</th>
                        <th>ç•ªå·</th>
                        <th>é£Ÿå“å</th>
                        <th>ã‚¨ãƒãƒ«ã‚®ãƒ¼(kcal)</th>
                        <th>ãŸã‚“ã±ãè³ª(g)</th>
                        <th>è„‚è³ª(g)</th>
                        <th>ç‚­æ°´åŒ–ç‰©(g)</th>
                        <th>ãƒŠãƒˆãƒªã‚¦ãƒ (mg)</th>
                        <th>ã‚«ãƒªã‚¦ãƒ (mg)</th>
                        <th>ã‚«ãƒ«ã‚·ã‚¦ãƒ (mg)</th>
                        <th>ãƒã‚°ãƒã‚·ã‚¦ãƒ (mg)</th>
                        <th>ãƒªãƒ³(mg)</th>
                        <th>é‰„(mg)</th>
                        <th>å‰Šé™¤</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

        <!-- æ¤œç´¢çµæœ -->
        <section id="food-table" style="display:none;">
            <h2>ğŸ½ æ¤œç´¢çµæœ</h2>
            <table id="foodTable">
                <thead>
                    <tr>
                        <th>ã‚°ãƒ«ãƒ¼ãƒ—</th>
                        <th>ç•ªå·</th>
                        <th>é£Ÿå“å</th>
                        <th>ã‚¨ãƒãƒ«ã‚®ãƒ¼(kcal)</th>
                        <th>ãŸã‚“ã±ãè³ª(g)</th>
                        <th>è„‚è³ª(g)</th>
                        <th>ç‚­æ°´åŒ–ç‰©(g)</th>
                        <th>Na(mg)</th>
                        <th>K(mg)</th>
                        <th>Ca(mg)</th>
                        <th>Mg(mg)</th>
                        <th>P(mg)</th>
                        <th>Fe(mg)</th>
                        <th>è¿½åŠ </th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

    </main>

    <div class="hamburger" id="hamburger">
        <h3>ğŸ” Googleæ¤œç´¢</h3>
        <form action="https://www.google.com/search" method="get" target="_blank">
            <input type="text" name="q">
            <button type="submit">æ¤œç´¢</button>
        </form>
    </div>

    <footer>Â© 2025 é£Ÿå“æˆåˆ†ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</footer>

    <script>
        function toggleMenu() {
            document.getElementById("hamburger").classList.toggle("open");
        }

        /* ===== ç›®æ¨™PFC èª­ã¿è¾¼ã¿ ===== */
        document.addEventListener("DOMContentLoaded", () => {
            const data = localStorage.getItem("target_pfc");
            if (!data) return;

            const pfc = JSON.parse(data);
            document.getElementById("totalResult").innerHTML = `
            <strong>${pfc.kcal} kcal</strong><br>
            Pï¼š${pfc.p} gã€€
            Fï¼š${pfc.f} gã€€
            Cï¼š${pfc.c} g<br>
            <a href="/pfc-compare">PFCè©³ç´°ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚‹ â†’</a>
        `;
        });
    </script>

    <script>
        const foods = {{ rows | tojson | safe }};
        const searchBtn = document.getElementById("searchBtn");
        const foodTableBody = document.querySelector("#foodTable tbody");
        const selectedTableBody = document.querySelector("#selectedTable tbody");
        const foodTableSection = document.getElementById("food-table");

        let selectedFoods = [];

        searchBtn.onclick = () => {
            const keyword = searchInput.value.trim();
            foodTableBody.innerHTML = "";
            if (!keyword) return;

            foods.filter(f => f.name.includes(keyword)).forEach(food => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${food.group}</td>
                <td>${food.number}</td>
                <td>${food.name}</td>
                <td>${food.enerc_kcal}</td>
                <td>${food.prot_}</td>
                <td>${food.fat_}</td>
                <td>${food.choavlm}</td>
                <td>${food.na}</td>
                <td>${food.k}</td>
                <td>${food.ca}</td>
                <td>${food.mg}</td>
                <td>${food.p}</td>
                <td>${food.fe}</td>
                <td><button>ï¼‹</button></td>
            `;
                tr.querySelector("button").onclick = () => {
                    selectedFoods.push(food);
                    renderSelectedFoods();
                    calculateTotal();
                };
                foodTableBody.appendChild(tr);
            });
            foodTableSection.style.display = "block";
        };

        function renderSelectedFoods() {
            selectedTableBody.innerHTML = "";
            selectedFoods.forEach((food, i) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${food.group}</td>
                <td>${food.number}</td>
                <td>${food.name}</td>
                <td>${food.enerc_kcal}</td>
                <td>${food.prot_}</td>
                <td>${food.fat_}</td>
                <td>${food.choavlm}</td>
                <td>${food.na}</td>
                <td>${food.k}</td>
                <td>${food.ca}</td>
                <td>${food.mg}</td>
                <td>${food.p}</td>
                <td>${food.fe}</td>
                <td><button>âœ•</button></td>
            `;
                tr.querySelector("button").onclick = () => {
                    selectedFoods.splice(i, 1);
                    renderSelectedFoods();
                    calculateTotal();
                };
                selectedTableBody.appendChild(tr);
            });
        }

        function calculateTotal() {
            const gram = Number(gramInput.value) || 100;
            const rate = gram / 100;
            let kcal = 0, p = 0, f = 0, c = 0;

            selectedFoods.forEach(food => {
                kcal += food.enerc_kcal * rate;
                p += food.prot_ * rate;
                f += food.fat_ * rate;
                c += food.choavlm * rate;
            });

            totalKcal.textContent = `${kcal.toFixed(0)} kcal`;
            totalP.textContent = p.toFixed(1);
            totalF.textContent = f.toFixed(1);
            totalC.textContent = c.toFixed(1);
        }

        applyGram.onclick = calculateTotal;
        resetGram.onclick = () => {
            gramInput.value = 100;
            calculateTotal();
        };
    </script>

</body>

</html>