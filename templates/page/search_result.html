<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ¤œç´¢çµæœ - é£Ÿå“æˆåˆ†ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</title>

    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: #f8fafc;
            color: #333;
        }

        header,
        footer {
            text-align: center;
        }

        header {
            background: #2f855a;
            color: white;
            padding: 15px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 5px;
            text-align: center;
        }

        th {
            background: #e2f0d9;
            cursor: pointer;
        }

        .dropdown {
            position: relative;
            display: inline-block;
            margin-bottom: 10px;
        }

        .dropdown-btn {
            padding: 8px 12px;
            background: #4caf50;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            z-index: 10;
            width: 200px;
        }

        .dropdown-content label {
            display: block;
            margin-bottom: 5px;
        }

        .dropdown.show .dropdown-content {
            display: block;
        }

        .section {
            margin: 10px 0;
            text-align: left;
        }

        .divider {
            border-bottom: 1px solid #ccc;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <header>
        <h1>é£Ÿå“æˆåˆ†ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ - æ¤œç´¢çµæœ</h1>
        <a href="/">ğŸ”™ æˆ»ã‚‹</a>
    </header>

    <main>
        <h2 style="text-align:left;">ã€Œ{{ keyword }}ã€ã®æ¤œç´¢çµæœ</h2>
        <!-- å‰æèª¬æ˜ -->
        <div class="section">
            <p>æœ¬ãƒšãƒ¼ã‚¸ã§ã¯ã€100gã‚ãŸã‚Šã®æ „é¤Šæˆåˆ†ã‚’åŸºæº–ã«è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p>
        </div>

        {% if rows %}
        <!-- åˆ†é‡æ“ä½œ -->
        <div class="section">
            <p>åˆ†é‡ï¼ˆgï¼‰ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€è¡¨ç¤ºã•ã‚Œã‚‹æ „é¤Šæˆåˆ†é‡ãŒè‡ªå‹•ã§å†è¨ˆç®—ã•ã‚Œã¾ã™ã€‚</p>
            <p>
                åˆ†é‡ï¼ˆgï¼‰:
                <input type="number" id="gramInput" value="100" min="1" style="width:80px;"> g
                <button id="applyGram">è¨ˆç®—</button>
                <button id="resetGram">100gã«æˆ»ã™</button>
            </p>
        </div>

        <div class="divider"></div>

        <!-- è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <div class="dropdown" id="columnDropdown">
                <button class="dropdown-btn">è¡¨ç¤ºã™ã‚‹åˆ—ã‚’é¸æŠ â–¼</button>
                <div class="dropdown-content">
                    <label><input type="checkbox" data-col="0" checked> ã‚°ãƒ«ãƒ¼ãƒ—</label>
                    <label><input type="checkbox" data-col="1" checked> ç•ªå·</label>
                    <label><input type="checkbox" data-col="2" checked> é£Ÿå“å</label>
                    <label><input type="checkbox" data-col="3" checked> ã‚¨ãƒãƒ«ã‚®ãƒ¼(kcal)</label>
                    <label><input type="checkbox" data-col="4" checked> ãŸã‚“ã±ãè³ª(g)</label>
                    <label><input type="checkbox" data-col="5" checked> è„‚è³ª(g)</label>
                    <label><input type="checkbox" data-col="6" checked> ç‚­æ°´åŒ–ç‰©(g)</label>
                    <label><input type="checkbox" data-col="7"> ãƒŠãƒˆãƒªã‚¦ãƒ (mg)</label>
                    <label><input type="checkbox" data-col="8"> ã‚«ãƒªã‚¦ãƒ (mg)</label>
                    <label><input type="checkbox" data-col="9"> ã‚«ãƒ«ã‚·ã‚¦ãƒ (mg)</label>
                    <label><input type="checkbox" data-col="10"> ãƒã‚°ãƒã‚·ã‚¦ãƒ (mg)</label>
                    <label><input type="checkbox" data-col="11"> ãƒªãƒ³(mg)</label>
                    <label><input type="checkbox" data-col="12"> é‰„(mg)</label>
                </div>
            </div>

            <button id="resetStars">
                â­ ãƒªã‚»ãƒƒãƒˆï¼ˆé¸æŠä¸­ <span id="compare-count">0</span> ä»¶ï¼‰
            </button>
        </div>

        <!-- ãƒ†ãƒ¼ãƒ–ãƒ« -->
        <table id="foodTable">
            <thead>
                <tr>
                    <th>ã‚°ãƒ«ãƒ¼ãƒ—</th>
                    <th>ç•ªå·</th>
                    <th>é£Ÿå“å</th>
                    <th>ã‚¨ãƒãƒ«ã‚®ãƒ¼(kcal)</th>
                    <th>ãŸã‚“ã±ãè³ª(g)</th>
                    <th>è„‚è³ª(g)</th>
                    <th>ç‚­æ°´åŒ–ç‰©(g)</th>
                    <th>ãƒŠãƒˆãƒªã‚¦ãƒ (mg)</th>
                    <th>ã‚«ãƒªã‚¦ãƒ (mg)</th>
                    <th>ã‚«ãƒ«ã‚·ã‚¦ãƒ (mg)</th>
                    <th>ãƒã‚°ãƒã‚·ã‚¦ãƒ (mg)</th>
                    <th>ãƒªãƒ³(mg)</th>
                    <th>é‰„(mg)</th>
                    <th>ãŠæ°—ã«å…¥ã‚Š</th>
                </tr>
            </thead>

            <tbody>
                {% for row in rows %}
                <tr data-id="{{ row[1] }}">
                    {% for col in row %}
                    <td>{{ col }}</td>
                    {% endfor %}
                    <td class="fav" data-id="{{ row[1] }}">â˜†</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% else %}
        <p style="text-align:center;">ã€Œ{{ keyword }}ã€ã«ä¸€è‡´ã™ã‚‹çµæœã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        {% endif %}

    </main>

    <footer>
        Â© 2025 Japan Science and Technology Agency. All rights reserved.
    </footer>

    <script src="/static/favorite.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const nutritionCols = [3, 4, 5, 6, 7, 8, 9, 10, 11, 12];

            /* 100gåŸºæº–å€¤ã‚’ä¿å­˜ */
            document.querySelectorAll("#foodTable tbody tr").forEach(row => {
                nutritionCols.forEach(idx => {
                    const cell = row.children[idx];
                    if (!cell) return;

                    const value = parseFloat(cell.innerText);
                    if (!isNaN(value)) {
                        cell.dataset.baseValue = value;
                    }
                });
            });

            /* åˆ†é‡è¨ˆç®— */
            function applyGram(gram) {
                const rate = gram / 100;

                document.querySelectorAll("#foodTable tbody tr").forEach(row => {
                    nutritionCols.forEach(idx => {
                        const cell = row.children[idx];
                        if (!cell || !cell.dataset.baseValue) return;

                        const base = parseFloat(cell.dataset.baseValue);
                        const newValue = base * rate;

                        cell.innerText = Number.isInteger(base)
                            ? Math.round(newValue)
                            : newValue.toFixed(2);
                    });
                });
            }

            document.getElementById("applyGram").addEventListener("click", () => {
                const gram = parseFloat(document.getElementById("gramInput").value);
                if (!isNaN(gram) && gram > 0) {
                    applyGram(gram);
                }
            });

            document.getElementById("resetGram").addEventListener("click", () => {
                document.getElementById("gramInput").value = 100;
                applyGram(100);
            });

            document.getElementById("gramInput").addEventListener("keydown", e => {
                if (e.key === "Enter") {
                    document.getElementById("applyGram").click();
                }
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {

            /* ===============================
               â–¼ è¡¨ç¤ºåˆ—ON / OFF
            =============================== */
            const checkboxes = document.querySelectorAll(".dropdown-content input[type='checkbox']");
            const table = document.getElementById("foodTable");

            checkboxes.forEach(cb => {
                cb.addEventListener("change", () => {
                    const colIndex = parseInt(cb.dataset.col);

                    // th
                    table.querySelectorAll("thead th")[colIndex].style.display =
                        cb.checked ? "" : "none";

                    // td
                    table.querySelectorAll("tbody tr").forEach(row => {
                        row.children[colIndex].style.display =
                            cb.checked ? "" : "none";
                    });
                });
            });

            /* ===============================
               â–¼ ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é–‹é–‰
            =============================== */
            const dropdown = document.getElementById("columnDropdown");
            const dropdownBtn = dropdown.querySelector(".dropdown-btn");

            dropdownBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                dropdown.classList.toggle("show");
            });

            document.addEventListener("click", () => {
                dropdown.classList.remove("show");
            });

        });
    </script>

</body>

</html>